#!/bin/bash

#
# muntar-one: invoked from GNU tar's "--to-command" option to take a single
# file emitted from a tar archive and upload it to Manta.
#

mu_arg0=$(basename $0)
mu_root="$1"

function fail
{
	echo "$mu_arg0: $*" >&2
	exit 1
}

[[ -n "$TAR_FILENAME" && -n "$TAR_SIZE" ]] || \
    fail "missing TAR_* vars; must be invoked from GNU tar with --to-command"

if [[ -z "$mu_root" ]]; then
	echo "usage: tar ... --to-command=\"$mu_arg0 MANTA_PATH\"" >&2
	echo "    where MANTA_PATH is a parent directory on Manta."
	exit 2
fi

mpipe -p $mu_root/$TAR_FILENAME
